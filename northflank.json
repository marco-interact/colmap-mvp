{
  "name": "colmap-mvp-backend-gpu",
  "description": "COLMAP 3D Reconstruction Backend (NVIDIA A100 GPU-optimized)",
  "spec": {
    "kind": "Deployment",
    "name": "colmap-backend-gpu",
    "billing": {
      "deploymentPlan": "nf-gpu-a100-10-1g"
    },
    "deployment": {
      "instances": 1,
      "minInstances": 1,
      "maxInstances": 3,
      "autoscaling": {
        "enabled": true,
        "cpuThreshold": 70,
        "memoryThreshold": 80
      },
      "storage": {
        "ephemeralStorage": {
          "storageSize": 102400
        },
        "persistentVolumes": [
          {
            "name": "colmap-persistent-data",
            "mountPath": "/persistent-data",
            "storageSize": 100000
          }
        ]
      },
      "docker": {
        "configType": "gpu"
      }
    },
    "runtimeEnvironment": {
      "resources": {
        "cpus": "12.0",
        "memory": "87040",
        "gpu": {
          "type": "nvidia-a100",
          "count": 1,
          "vramMB": 40960
        }
      },
      "runtimeFiles": [
        {
          "name": "requirements.txt",
          "path": "/app/requirements.txt",
          "type": "file"
        },
        {
          "name": "main.py",
          "path": "/app/main.py",
          "type": "file"
        },
        {
          "name": "database.py",
          "path": "/app/database.py",
          "type": "file"
        }
      ]
    },
    "ports": [
      {
        "name": "http",
        "internalPort": 8000,
        "protocol": "HTTP",
        "public": true,
        "domains": []
      }
    ],
    "buildSettings": {
      "dockerfile": {
        "buildEngine": "kaniko",
        "dockerfilePath": "/Dockerfile",
        "dockerWorkDir": "/app",
        "useCache": true
      }
    },
    "buildArguments": {},
    "vcsData": {
      "projectUrl": "https://github.com/marco-interact/colmap-mvp",
      "projectType": "github",
      "accountLogin": "marco-interact",
      "projectId": "colmap-mvp"
    },
    "buildConfiguration": {
      "pathIgnoreRules": [
        "node_modules/**",
        "src/**",
        "public/**",
        "docs/**",
        "scripts/**"
      ]
    },
    "environmentVariables": [
      {
        "key": "PORT",
        "value": "8000"
      },
      {
        "key": "PYTHONUNBUFFERED",
        "value": "1"
      },
      {
        "key": "CUDA_VISIBLE_DEVICES",
        "value": "0"
      },
      {
        "key": "NVIDIA_VISIBLE_DEVICES",
        "value": "all"
      },
      {
        "key": "NVIDIA_DRIVER_CAPABILITIES",
        "value": "compute,utility"
      },
      {
        "key": "COLMAP_GPU_ENABLED",
        "value": "1"
      },
      {
        "key": "COLMAP_GPU_INDEX",
        "value": "0"
      },
      {
        "key": "COLMAP_NUM_THREADS",
        "value": "12"
      },
      {
        "key": "MAX_MEMORY_GB",
        "value": "70"
      },
      {
        "key": "CACHE_SIZE_GB",
        "value": "10"
      },
      {
        "key": "STORAGE_DIR",
        "value": "/persistent-data/results"
      },
      {
        "key": "CACHE_DIR",
        "value": "/persistent-data/cache"
      },
      {
        "key": "DATABASE_PATH",
        "value": "/persistent-data/database.db"
      },
      {
        "key": "UPLOADS_DIR",
        "value": "/persistent-data/uploads"
      },
      {
        "key": "LOG_LEVEL",
        "value": "INFO"
      }
    ],
    "healthCheck": {
      "livenessProbe": {
        "httpGet": {
          "path": "/health",
          "port": 8000
        },
        "initialDelaySeconds": 40,
        "periodSeconds": 30,
        "timeoutSeconds": 10,
        "successThreshold": 1,
        "failureThreshold": 3
      },
      "readinessProbe": {
        "httpGet": {
          "path": "/readiness",
          "port": 8000
        },
        "initialDelaySeconds": 30,
        "periodSeconds": 10,
        "timeoutSeconds": 5,
        "successThreshold": 1,
        "failureThreshold": 3
      }
    }
  }
}


